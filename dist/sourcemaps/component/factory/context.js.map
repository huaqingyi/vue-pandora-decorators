{"version":3,"sources":["../src/component/factory/context.ts"],"names":[],"mappings":";;;AAAA,mCAA4D;AAC5D,6BAA8C;AAC9C,+BAAuC;AAEvC,uCAAoC;AAEpC,MAAa,cAAe,SAAQ,iBAAO;IAIvC,YACW,SAAc,EACd,MAAyC,EACzC,IAAmB;QAE1B,KAAK,EAAE,CAAC;QAJD,cAAS,GAAT,SAAS,CAAK;QACd,WAAM,GAAN,MAAM,CAAmC;QACzC,SAAI,GAAJ,IAAI,CAAe;QAG1B,IAAI,CAAC,KAAK,GAAG,eAAQ,EAAE,CAAC;IAC5B,CAAC;IAEM,MAAM;QACT,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QAC3B,YAAG,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE,CAAkB,EAAE,EAAE;YAC1C,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,EAAE;gBAAE,OAAO,CAAC,CAAA;aAAE;YAAA,CAAC;YACtC,IAAI,iBAAQ,CAAC,CAAC,CAAC,EAAE;gBAEb,IAAI,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE;oBACrC,IAAI,iBAAQ,CAAC,CAAC,CAAC,IAAI,iBAAQ,CAAC,CAAC,CAAC,IAAI,kBAAS,CAAC,CAAC,CAAC,EAAE;wBAC5C,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,SAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;qBAC9C;yBAAM;wBACH,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,cAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;qBACnD;oBACD,OAAO,CAAC,CAAC;iBACZ;gBAED,IAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE;oBACnC,MAAM,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;oBAC1D,IAAI,WAAW,IAAI,WAAW,YAAY,QAAQ,EAAE;wBAChD,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,cAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;qBACzE;oBACD,OAAO,CAAC,CAAC;iBACZ;gBAED,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE;oBACtC,MAAM,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;oBAChE,IAAI,cAAc,IAAI,cAAc,YAAY,QAAQ,EAAE;wBACtD,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,cAAQ,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;qBAChE;oBACD,OAAO,CAAC,CAAC;iBACZ;gBACD,OAAO,CAAC,CAAC;aACZ;QACL,CAAC,CAAC,CAAC;QACH,OAAO,EAAE,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC;IAC7D,CAAC;CACJ;AAhDD,wCAgDC","file":"../../../component/factory/context.js","sourcesContent":["import { isBoolean, isNumber, isString, map } from 'lodash';\nimport { ref, reactive, computed } from 'vue';\nimport { useStore, Store } from 'vuex';\nimport { PureComponent, PureComponentClass } from '../component';\nimport { Factory } from './factory';\n\nexport class ContextFactory extends Factory {\n\n    private store: Store<any>;\n\n    constructor(\n        public setupData: any,\n        public target: PureComponentClass<PureComponent>,\n        public comp: PureComponent,\n    ) {\n        super();\n        this.store = useStore();\n    }\n\n    public output<T = any>(): T {\n        const Target = this.target;\n        map(this.setupData, (o, k: string | Symbol) => {\n            if (k === this.proxyKey) { return o };\n            if (isString(k)) {\n                // reactived data is truer ?\n                if (this.isDynamic(Target.prototype, k)) {\n                    if (isString(o) || isNumber(o) || isBoolean(o)) {\n                        this.setupData[k] = ref(this.setupData[k]);\n                    } else {\n                        this.setupData[k] = reactive(this.setupData[k]);\n                    }\n                    return o;\n                } \n                \n                if (this.isState(Target.prototype, k)) {\n                    const stateEffect = this.stateEffect(Target.prototype, k);\n                    if (stateEffect && stateEffect instanceof Function) {\n                        this.setupData[k] = computed(stateEffect.bind(this.comp, this.store));\n                    }\n                    return o;\n                } \n                \n                if (this.isComputed(Target.prototype, k)) {\n                    const computedEffect = this.computedEffect(Target.prototype, k);\n                    if (computedEffect && computedEffect instanceof Function) {\n                        this.setupData[k] = computed(computedEffect.bind(this.comp));\n                    }\n                    return o;\n                }\n                return o;\n            }\n        });\n        return { ...this.setupData, [this.proxyKey]: this.comp };\n    }\n}\n"]}